/* eslint-disable @typescript-eslint/no-unused-vars */
// File: app/exam/results/page.tsx
"use client";

import React, { useEffect } from "react";
import { useRouter } from "next/navigation";
import { useSelector, useDispatch } from "react-redux";
import type { RootState } from "@/app/lib/store";
import { resetExam } from "@/app/lib/slices/examSlice";
import { calculatePercentage } from "@/app/lib/utils";
import Navbar from "@/app/components/ui/Navbar";

export default function ResultsPage() {
  const router = useRouter();
  const dispatch = useDispatch();
  const { result, examInfo } = useSelector((s: RootState) => s.exam);

  useEffect(() => {
    if (!result) {
      router.push("/");
      return;
    }
  }, [result, router]);

  if (!result) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-[#f2fbfd]">
        <div className="text-center">
          <div className="animate-spin rounded-full h-14 w-14 border-b-2 border-teal-600 mx-auto"></div>
          <p className="mt-4 text-gray-600">Loading results...</p>
        </div>
      </div>
    );
  }

  const totalMarks = examInfo?.total_marks ?? 100;
  const percentage = calculatePercentage(result.score, totalMarks);
  const isPass = percentage >= 60;

  const handleDone = () => {
    dispatch(resetExam());
    router.push("/");
  };

  // Colors used for the small squares on the left
  const statItems = [
    {
      label: "Total Questions",
      value: examInfo?.questions_count ?? examInfo?.total_marks ?? 100,
      color: "bg-amber-400",
      icon: (
        <>
          <svg
            width="14"
            height="14"
            viewBox="0 0 14 14"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M8.33141 9.02569C8.52812 9.02569 8.6988 8.95337 8.84344 8.80873C8.98808 8.66408 9.0604 8.49341 9.0604 8.29669C9.0604 8.09998 8.98808 7.9293 8.84344 7.78466C8.6988 7.64002 8.52812 7.56769 8.33141 7.56769C8.13469 7.56769 7.96402 7.64002 7.81937 7.78466C7.67473 7.9293 7.60241 8.09998 7.60241 8.29669C7.60241 8.49341 7.67473 8.66408 7.81937 8.80873C7.96402 8.95337 8.13469 9.02569 8.33141 9.02569ZM8.33141 6.80398C8.45869 6.80398 8.5773 6.7577 8.68723 6.66513C8.79716 6.57255 8.86369 6.45105 8.88683 6.30063C8.90998 6.16177 8.95916 6.03448 9.03437 5.91877C9.10958 5.80306 9.24555 5.64684 9.44226 5.45013C9.7894 5.10299 10.0208 4.82238 10.1365 4.60831C10.2523 4.39424 10.3101 4.14256 10.3101 3.85328C10.3101 3.33256 10.1279 2.90731 9.76337 2.57753C9.39887 2.24774 8.92155 2.08285 8.33141 2.08285C7.94955 2.08285 7.60241 2.16964 7.28998 2.34321C6.97755 2.51678 6.72877 2.76556 6.54363 3.08956C6.4742 3.20528 6.46841 3.32678 6.52627 3.45406C6.58413 3.58135 6.68248 3.67392 6.82134 3.73178C6.94863 3.78963 7.07302 3.79542 7.19452 3.74913C7.31602 3.70285 7.41727 3.62185 7.49827 3.50613C7.60241 3.35571 7.72391 3.24288 7.86277 3.16767C8.00162 3.09246 8.15784 3.05485 8.33141 3.05485C8.60912 3.05485 8.83476 3.13296 9.00833 3.28917C9.1819 3.44538 9.26869 3.65656 9.26869 3.9227C9.26869 4.0847 9.2224 4.23802 9.12983 4.38267C9.03726 4.52731 8.87526 4.70956 8.64384 4.92942C8.30826 5.2187 8.09419 5.44145 8.00162 5.59766C7.90905 5.75388 7.85119 5.98241 7.82805 6.28327C7.81648 6.42213 7.85987 6.54363 7.95823 6.64777C8.05659 6.75191 8.18098 6.80398 8.33141 6.80398ZM4.1657 11.1085C3.78385 11.1085 3.45696 10.9726 3.18503 10.7007C2.9131 10.4287 2.77714 10.1018 2.77714 9.71997V1.38857C2.77714 1.00671 2.9131 0.67982 3.18503 0.407892C3.45696 0.135964 3.78385 0 4.1657 0H12.4971C12.879 0 13.2059 0.135964 13.4778 0.407892C13.7497 0.67982 13.8857 1.00671 13.8857 1.38857V9.71997C13.8857 10.1018 13.7497 10.4287 13.4778 10.7007C13.2059 10.9726 12.879 11.1085 12.4971 11.1085H4.1657ZM1.38857 13.8857C1.00671 13.8857 0.67982 13.7497 0.407892 13.4778C0.135964 13.2059 0 12.879 0 12.4971V3.47142C0 3.27471 0.0665355 3.10981 0.199607 2.97674C0.332678 2.84367 0.49757 2.77714 0.694284 2.77714C0.890998 2.77714 1.05589 2.84367 1.18896 2.97674C1.32203 3.10981 1.38857 3.27471 1.38857 3.47142V12.4971H10.4143C10.611 12.4971 10.7759 12.5636 10.9089 12.6967C11.042 12.8298 11.1085 12.9947 11.1085 13.1914C11.1085 13.3881 11.042 13.553 10.9089 13.6861C10.7759 13.8191 10.611 13.8857 10.4143 13.8857H1.38857Z"
              fill="white"
            />
          </svg>
        </>
      ),
    },
    {
      label: "Correct Answers",
      value: result.correct,
      color: "bg-emerald-500",
      icon: (
        <>
          <svg
            width="14"
            height="14"
            viewBox="0 0 14 14"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M3.18516 10.7011C3.45709 10.973 3.784 11.109 4.16587 11.109H12.4976C12.8795 11.109 13.2064 10.973 13.4783 10.7011C13.7503 10.4291 13.8862 10.1022 13.8862 9.72037V1.38862C13.8862 1.00675 13.7503 0.679847 13.4783 0.407908C13.2064 0.135969 12.8795 0 12.4976 0H4.16587C3.784 0 3.45709 0.135969 3.18516 0.407908C2.91322 0.679847 2.77725 1.00675 2.77725 1.38862V9.72037C2.77725 10.1022 2.91322 10.4291 3.18516 10.7011ZM0.407908 13.4783C0.679847 13.7503 1.00675 13.8862 1.38862 13.8862H10.4147C10.6114 13.8862 10.7763 13.8197 10.9094 13.6866C11.0425 13.5535 11.109 13.3886 11.109 13.1919C11.109 12.9952 11.0425 12.8303 10.9094 12.6972C10.7763 12.5642 10.6114 12.4976 10.4147 12.4976H1.38862V3.47156C1.38862 3.27484 1.32209 3.10994 1.18901 2.97686C1.05593 2.84379 0.891034 2.77725 0.694312 2.77725C0.49759 2.77725 0.332691 2.84379 0.199615 2.97686C0.0665382 3.10994 0 3.27484 0 3.47156V12.4976C0 12.8795 0.135969 13.2064 0.407908 13.4783ZM12.2697 3.38424C12.4956 3.151 12.4897 2.77881 12.2564 2.55292C12.0232 2.32704 11.651 2.333 11.4251 2.56624L7.77182 6.33843L6.34252 5.06348C6.10022 4.84734 5.72859 4.86855 5.51245 5.11085C5.29632 5.35315 5.31753 5.72478 5.55982 5.94092L7.41022 7.5915C7.64552 7.80139 8.00451 7.78828 8.22388 7.56178L12.2697 3.38424Z"
              fill="white"
            />
          </svg>
        </>
      ),
    },
    {
      label: "Incorrect Answers",
      value: result.wrong,
      color: "bg-rose-500",
      icon: (
        <>
          <svg
            width="14"
            height="14"
            viewBox="0 0 14 14"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M4.16587 11.109C3.784 11.109 3.45709 10.973 3.18516 10.7011C2.91322 10.4291 2.77725 10.1022 2.77725 9.72037V1.38862C2.77725 1.00675 2.91322 0.679847 3.18516 0.407908C3.45709 0.135969 3.784 0 4.16587 0H12.4976C12.8795 0 13.2064 0.135969 13.4783 0.407908C13.7503 0.679847 13.8862 1.00675 13.8862 1.38862V9.72037C13.8862 10.1022 13.7503 10.4291 13.4783 10.7011C13.2064 10.973 12.8795 11.109 12.4976 11.109H4.16587ZM1.38862 13.8862C1.00675 13.8862 0.679847 13.7503 0.407908 13.4783C0.135969 13.2064 0 12.8795 0 12.4976V3.47156C0 3.27484 0.0665382 3.10994 0.199615 2.97686C0.332691 2.84379 0.49759 2.77725 0.694312 2.77725C0.891034 2.77725 1.05593 2.84379 1.18901 2.97686C1.32209 3.10994 1.38862 3.27484 1.38862 3.47156V12.4976H10.4147C10.6114 12.4976 10.7763 12.5642 10.9094 12.6972C11.0425 12.8303 11.109 12.9952 11.109 13.1919C11.109 13.3886 11.0425 13.5535 10.9094 13.6866C10.7763 13.8197 10.6114 13.8862 10.4147 13.8862H1.38862ZM5.53546 8.35126C5.30587 8.12167 5.30587 7.74943 5.53546 7.51984L7.59998 5.45532L5.53546 3.39081C5.30587 3.16122 5.30587 2.78898 5.53546 2.55939C5.76505 2.3298 6.13729 2.3298 6.36688 2.55939L8.4314 4.6239L10.4948 2.56047C10.7244 2.33088 11.0967 2.33088 11.3263 2.56047C11.5558 2.79006 11.5558 3.1623 11.3263 3.39188L9.26282 5.45532L11.3263 7.51876C11.5558 7.74835 11.5558 8.12059 11.3263 8.35018C11.0967 8.57977 10.7244 8.57977 10.4948 8.35018L8.4314 6.28674L6.36688 8.35126C6.13729 8.58085 5.76505 8.58085 5.53546 8.35126Z"
              fill="white"
            />
          </svg>
        </>
      ),
    },
    {
      label: "Not Attended Questions",
      value: result.not_attended,
      color: "bg-neutral-500",
      icon: (
        <>
          <svg
            width="14"
            height="14"
            viewBox="0 0 14 14"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M8.33141 9.02569C8.52812 9.02569 8.6988 8.95337 8.84344 8.80873C8.98808 8.66408 9.0604 8.49341 9.0604 8.29669C9.0604 8.09998 8.98808 7.9293 8.84344 7.78466C8.6988 7.64002 8.52812 7.56769 8.33141 7.56769C8.13469 7.56769 7.96402 7.64002 7.81937 7.78466C7.67473 7.9293 7.60241 8.09998 7.60241 8.29669C7.60241 8.49341 7.67473 8.66408 7.81937 8.80873C7.96402 8.95337 8.13469 9.02569 8.33141 9.02569ZM8.33141 6.80398C8.45869 6.80398 8.5773 6.7577 8.68723 6.66513C8.79716 6.57255 8.86369 6.45105 8.88683 6.30063C8.90998 6.16177 8.95916 6.03448 9.03437 5.91877C9.10958 5.80306 9.24555 5.64684 9.44226 5.45013C9.7894 5.10299 10.0208 4.82238 10.1365 4.60831C10.2523 4.39424 10.3101 4.14256 10.3101 3.85328C10.3101 3.33256 10.1279 2.90731 9.76337 2.57753C9.39887 2.24774 8.92155 2.08285 8.33141 2.08285C7.94955 2.08285 7.60241 2.16964 7.28998 2.34321C6.97755 2.51678 6.72877 2.76556 6.54363 3.08956C6.4742 3.20528 6.46841 3.32678 6.52627 3.45406C6.58413 3.58135 6.68248 3.67392 6.82134 3.73178C6.94863 3.78963 7.07302 3.79542 7.19452 3.74913C7.31602 3.70285 7.41727 3.62185 7.49827 3.50613C7.60241 3.35571 7.72391 3.24288 7.86277 3.16767C8.00162 3.09246 8.15784 3.05485 8.33141 3.05485C8.60912 3.05485 8.83476 3.13296 9.00833 3.28917C9.1819 3.44538 9.26869 3.65656 9.26869 3.9227C9.26869 4.0847 9.2224 4.23802 9.12983 4.38267C9.03726 4.52731 8.87526 4.70956 8.64384 4.92942C8.30826 5.2187 8.09419 5.44145 8.00162 5.59766C7.90905 5.75388 7.85119 5.98241 7.82805 6.28327C7.81648 6.42213 7.85987 6.54363 7.95823 6.64777C8.05659 6.75191 8.18098 6.80398 8.33141 6.80398ZM4.1657 11.1085C3.78385 11.1085 3.45696 10.9726 3.18503 10.7007C2.9131 10.4287 2.77714 10.1018 2.77714 9.71997V1.38857C2.77714 1.00671 2.9131 0.67982 3.18503 0.407892C3.45696 0.135964 3.78385 0 4.1657 0H12.4971C12.879 0 13.2059 0.135964 13.4778 0.407892C13.7497 0.67982 13.8857 1.00671 13.8857 1.38857V9.71997C13.8857 10.1018 13.7497 10.4287 13.4778 10.7007C13.2059 10.9726 12.879 11.1085 12.4971 11.1085H4.1657ZM1.38857 13.8857C1.00671 13.8857 0.67982 13.7497 0.407892 13.4778C0.135964 13.2059 0 12.879 0 12.4971V3.47142C0 3.27471 0.0665355 3.10981 0.199607 2.97674C0.332678 2.84367 0.49757 2.77714 0.694284 2.77714C0.890998 2.77714 1.05589 2.84367 1.18896 2.97674C1.32203 3.10981 1.38857 3.27471 1.38857 3.47142V12.4971H10.4143C10.611 12.4971 10.7759 12.5636 10.9089 12.6967C11.042 12.8298 11.1085 12.9947 11.1085 13.1914C11.1085 13.3881 11.042 13.553 10.9089 13.6861C10.7759 13.8191 10.611 13.8857 10.4143 13.8857H1.38857Z"
              fill="white"
            />
          </svg>
        </>
      ),
    },
  ];

  return (
    <div className="min-h-screen bg-[#f2fbfd]">
      <Navbar />

      <div className="w-full mx-auto">
        {/* Top logo area (keeps page breathing like screenshot) */}

        <div className="px-8 py-10">
          {/* Score card (big centered rounded gradient) */}
          <div className="mx-auto mb-8 max-w-md">
            <div
              className="rounded-2xl px-6 py-8 text-center text-white shadow-inner"
              style={{
                background: "linear-gradient(135deg,#0e7a86 0%, #06353f 100%)",
                boxShadow: "inset 0 -12px 24px rgba(0,0,0,0.25)",
              }}
            >
              <div className="text-sm font-medium opacity-90 mb-2">
                Marks Obtained:
              </div>
              <div className="text-6xl font-semibold tracking-tight leading-none">
                {result.score}{" "}
                <span className="text-6xl font-semibold">/ {totalMarks}</span>
              </div>
            </div>
          </div>

          {/* Two-column list: labels with left colored square, numbers right */}
          <div className="max-w-md mx-auto">
            <div className="space-y-4">
              {statItems.map((s) => (
                <div
                  key={s.label}
                  className="flex items-center justify-between px-3"
                >
                  <div className="flex items-center gap-3">
                    <div
                      className={`${s.color} w-9 h-9 rounded-md flex items-center justify-center shadow-sm`}
                    >
                      {/* Optionally icons can go here; keep short label style */}
                      {s.icon}
                    </div>
                    <div className="text-sm text-gray-700">{s.label}</div>
                  </div>
                  <div className="text-sm font-semibold text-gray-800 tabular-nums">
                    {String(s.value).padStart(3, "0")}
                  </div>
                </div>
              ))}
            </div>

            {/* Done button (full width like screenshot) */}
            <div className="mt-8">
              <button
                onClick={handleDone}
                className="w-full bg-slate-800 hover:bg-slate-900 text-white font-semibold py-3 rounded-md shadow focus:outline-none transition transform hover:-translate-y-0.5"
              >
                Done
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
